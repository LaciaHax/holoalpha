<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ホロライブ スケジュール</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            position: relative;
        }

        .schedule {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .date-group {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .date-group.hidden {
            display: none;
        }

        .date-group.selected {
            border-left: 4px solid #007bff;
        }

        .video {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            cursor: pointer;
        }

        .video img.thumbnail {
            width: 120px;
            height: 68px;
            border-radius: 4px;
            margin-right: 10px;
            cursor: pointer;
        }

        .video-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .video-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0;
        }

        .video-title a {
            text-decoration: none;
            color: #000;
        }

        .video-title a:hover {
            text-decoration: underline;
        }

        .video-name {
            font-size: 14px;
            color: #555;
            margin: 5px 0;
            display: flex;
            align-items: center;
        }

        .video-name img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 5px;
            cursor: pointer;
        }

        .video-time {
            font-size: 14px;
            color: #999;
            margin: 5px 0;
        }

        video,
        .category-line,
        select,
        input[type="checkbox"] {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="checkbox"]:focus,
        select:focus,
        input[type="date"]:focus {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .video {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 10px;
        }

        .video:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .collabo-talents {
            display: flex;
            flex-wrap: wrap;
            margin-top: 5px;
        }

        .collabo-talent {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .collabo-talent img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 5px;
            cursor: pointer;
        }

        .collabo-talent span {
            font-size: 12px;
            color: #555;
        }

        .status {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 5px;
            font-size: 12px;
        }

        .status.live {
            border-left: 4px solid red;
        }

        .status.scheduled {
            border-left: 4px solid #ffc107;
        }

        .status.past {
            border-left: 4px solid #6c757d;
        }

        .settings-button {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
            z-index: 1000;
        }

        .settings-button.rotate {
            transform: rotate(90deg);
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: #fff;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.3s;
            padding: 20px;
            box-sizing: border-box;
            z-index: 1000;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-panel h3 {
            margin-top: 0;
        }

        .settings-panel label {
            display: block;
            margin-bottom: 10px;
        }

        .settings-panel input[type="checkbox"] {
            margin-right: 10px;
        }

        .settings-panel input[type="date"],
        .settings-panel select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .settings-panel .category {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .close-settings-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
        }

        .category-line {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .category-line span {
            margin-left: 10px;
        }

        .category-line.live {
            border-left: 4px solid #28a745;
        }

        .category-line.scheduled {
            border-left: 4px solid #ffc107;
        }

        .category-line.past {
            border-left: 4px solid #6c757d;
        }
    </style>
</head>

<body>
    <div class="schedule">
    </div>

    <div class="settings-button" onclick="toggleSettings()">
        ⚙️
    </div>

    <div class="settings-panel" id="settingsPanel">
        <div class="close-settings-button" onclick="toggleSettings()">
            ✖️
        </div>
        <h3>設定</h3>

        <div class="category">
            <label>
                <input type="checkbox" id="liveCheckbox" checked>
                配信中を表示
            </label>
            <label>
                <input type="checkbox" id="scheduledCheckbox" checked>
                配信予定を表示
            </label>
            <label>
                <input type="checkbox" id="pastCheckbox" checked>
                配信済みを表示
            </label>
        </div>

        <div class="category">
            <div id="dateCheckboxes">
            </div>
        </div>

        <div class="category">
            <label>
                配信者
                <select id="talentFilter">
                    <option value="">全て</option>
                </select>
            </label>
        </div>
    </div>
    <script>
        let showLive = true;
        let showScheduled = true;
        let showPast = true;
        let selectedDates = new Set();
        let selectedTalent = '';

        function areAllCheckboxesChecked() {
            const checkboxes = document.querySelectorAll('#dateCheckboxes input[type="checkbox"]');
            return Array.from(checkboxes).every(checkbox => checkbox.checked);
        }

        function toggleSettings() {
            const settingsButton = document.querySelector('.settings-button');
            const settingsPanel = document.getElementById('settingsPanel');

            settingsPanel.classList.toggle('open');
            settingsButton.classList.toggle('rotate');
        }

        function updateSchedule() {
            console.log('Updating schedule...');
            const now = new Date();

            const dateGroups = document.querySelectorAll('.date-group');
            let anyDateVisible = false;
            let anyVideoVisible = false;

            dateGroups.forEach(dateGroup => {
                const date = dateGroup.querySelector('h2').textContent;
                console.log(`Checking date group: ${date}`);

                const checkbox = document.querySelector(`#dateCheckboxes input[type="checkbox"][value="${date}"]`);
                if (checkbox && checkbox.checked) {
                    console.log(`Showing date group: ${date}`);
                    dateGroup.classList.remove('hidden');
                    anyDateVisible = true;
                } else {
                    console.log(`Hiding date group: ${date}`);
                    dateGroup.classList.add('hidden');
                }

                dateGroup.querySelectorAll('.video').forEach(videoElement => {
                    const statusText = videoElement.querySelector('.status').textContent;
                    const talentName = videoElement.querySelector('.video-name span').textContent;
                    console.log(`Checking video: ${statusText} by ${talentName}`);

                    if (statusText === '配信中') {
                        videoElement.style.display = showLive ? 'flex' : 'none';
                    } else if (statusText === '配信予定') {
                        videoElement.style.display = showScheduled ? 'flex' : 'none';
                    } else if (statusText === '配信済み') {
                        videoElement.style.display = showPast ? 'flex' : 'none';
                    }

                    if (selectedTalent && talentName !== selectedTalent) {
                        videoElement.style.display = 'none';
                    } else {
                        videoElement.style.display = videoElement.style.display === 'none' ? 'flex' : videoElement.style.display;
                    }

                    if (videoElement.style.display === 'flex') {
                        anyVideoVisible = true;
                    }
                });
            });

            const schedule = document.querySelector('.schedule');
            if (!anyDateVisible || !anyVideoVisible) {
                console.log('Hiding schedule');
                schedule.style.display = 'none';
            } else {
                console.log('Showing schedule');
                schedule.style.display = 'block';
            }
        }

        document.getElementById('liveCheckbox').addEventListener('change', function () {
            showLive = this.checked;
            console.log(`Live checkbox changed: ${showLive}`);
            updateSchedule();
        });

        document.getElementById('scheduledCheckbox').addEventListener('change', function () {
            showScheduled = this.checked;
            console.log(`Scheduled checkbox changed: ${showScheduled}`);
            updateSchedule();
        });

        document.getElementById('pastCheckbox').addEventListener('change', function () {
            showPast = this.checked;
            console.log(`Past checkbox changed: ${showPast}`);
            updateSchedule();
        });

        document.getElementById('talentFilter').addEventListener('change', function () {
            selectedTalent = this.value;
            console.log(`Talent filter changed: ${selectedTalent}`);
            updateSchedule();
        });

        fetch('https://schedule.hololive.tv/api/list/7')
            .then(response => response.json())
            .then(data => {
                const schedule = document.querySelector('.schedule');
                const now = new Date();

                const sortedDateGroups = data.dateGroupList.sort((a, b) => new Date(b.displayDate) - new Date(a.displayDate));

                const talentOptions = new Set();
                const dateCheckboxesContainer = document.getElementById('dateCheckboxes');

                sortedDateGroups.forEach(dateGroup => {
                    const dateGroupElement = document.createElement('div');
                    dateGroupElement.classList.add('date-group');

                    const dateElement = document.createElement('h2');
                    dateElement.textContent = dateGroup.displayDate;
                    dateGroupElement.appendChild(dateElement);

                    const sortedVideos = dateGroup.videoList.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));

                    sortedVideos.forEach(video => {
                        const videoElement = document.createElement('div');
                        videoElement.classList.add('video');

                        const thumbnail = document.createElement('img');
                        thumbnail.src = video.thumbnail;
                        thumbnail.classList.add('thumbnail');
                        thumbnail.onclick = () => window.open(video.url, '_blank'); // サムネイルクリックでURLを開く
                        videoElement.appendChild(thumbnail);

                        const videoInfo = document.createElement('div');
                        videoInfo.classList.add('video-info');

                        const videoTitle = document.createElement('p');
                        videoTitle.classList.add('video-title');
                        const titleLink = document.createElement('a');
                        titleLink.href = video.url;
                        titleLink.target = "_blank";
                        titleLink.textContent = video.title ? video.title : 'タイトルがありません。';
                        videoTitle.appendChild(titleLink);
                        videoInfo.appendChild(videoTitle);

                        const videoName = document.createElement('p');
                        videoName.classList.add('video-name');

                        const talentIcon = document.createElement('img');
                        talentIcon.src = video.talent.iconImageUrl;
                        videoName.appendChild(talentIcon);

                        const talentName = document.createElement('span');
                        talentName.textContent = video.name;
                        videoName.appendChild(talentName);

                        videoInfo.appendChild(videoName);

                        const videoTime = document.createElement('p');
                        videoTime.classList.add('video-time');
                        videoTime.textContent = video.displayDate;
                        videoInfo.appendChild(videoTime);

                        const collaboContainer = document.createElement('div');
                        collaboContainer.classList.add('collabo-talents');
                        video.collaboTalents.forEach(collabo => {
                            const collaboElement = document.createElement('div');
                            collaboElement.classList.add('collabo-talent');

                            const collaboIcon = document.createElement('img');
                            collaboIcon.src = collabo.iconImageUrl;
                            collaboIcon.onclick = () => window.open(collabo.channelUrl, '_blank'); // コラボのアイコンクリックでチャンネルを開く
                            collaboElement.appendChild(collaboIcon);

                            const collaboName = document.createElement('span');
                            collaboName.textContent = collabo.name;
                            collaboElement.appendChild(collaboName);

                            collaboContainer.appendChild(collaboElement);

                            talentOptions.add(collabo.name);
                        });

                        videoInfo.appendChild(collaboContainer);

                        const status = document.createElement('div');
                        status.classList.add('status');

                        let scheduledTime;
                        try {
                            scheduledTime = new Date(video.datetime.replace(/\//g, '-'));
                        } catch (e) {
                            console.error('Invalid date format for scheduledTime:', video.datetime);
                            scheduledTime = new Date();
                        }

                        if (video.isLive) {
                            status.textContent = '配信中';
                            status.classList.add('live');
                        } else if (scheduledTime < now) {
                            status.textContent = '配信済み';
                            status.classList.add('past');
                        } else {
                            status.textContent = '配信予定';
                            status.classList.add('scheduled');
                        }

                        videoElement.appendChild(status);
                        videoElement.appendChild(videoInfo);
                        dateGroupElement.appendChild(videoElement);
                    });

                    schedule.appendChild(dateGroupElement);

                    const dateCheckbox = document.createElement('label');
                    const dateCheckboxInput = document.createElement('input');
                    dateCheckboxInput.type = 'checkbox';
                    dateCheckboxInput.value = dateGroup.displayDate;
                    dateCheckboxInput.checked = true;
                    dateCheckboxInput.addEventListener('change', function () {
                        if (this.checked) {
                            selectedDates.add(this.value);
                        } else {
                            selectedDates.delete(this.value);
                        }
                        updateSchedule();
                    });

                    const dateCheckboxLabel = document.createElement('span');
                    dateCheckboxLabel.textContent = dateGroup.displayDate;
                    dateCheckbox.appendChild(dateCheckboxInput);
                    dateCheckbox.appendChild(dateCheckboxLabel);

                    dateCheckboxesContainer.appendChild(dateCheckbox);

                    selectedDates.add(dateGroup.displayDate);
                });

                updateSchedule();

                const talentFilter = document.getElementById('talentFilter');
                talentOptions.forEach(talent => {
                    const option = document.createElement('option');
                    option.value = talent;
                    option.textContent = talent;
                    talentFilter.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>
</body>

</html>